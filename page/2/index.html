<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>WeilunZhou</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="WeilunZhou" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/archives" class="header__link">Archive</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">WeilunZhou</a></h1>
		<h2 class="header__subtitle">ä¸ªäººåšå®¢</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">ğŸ“– <a href="/">earlier posts</a> ğŸ“–</span>




	<article>
	
		<h1><a href="/article/victoriametrics/">victoriametrics</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2020-03-14</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/tsdb/">tsdb</a>
			</span>
		
	</div>

	

	
		<h2 id="victoriametricsä¸ºä»€ä¹ˆå¿«">VictoriaMetricsä¸ºä»€ä¹ˆå¿«ï¼Ÿ</h2>
<ul>
<li><a href="https://medium.com/faun/victoriametrics-creating-the-best-remote-storage-for-prometheus-5d92d66787ac" target="_blank" rel="noopener">VictoriaMetrics â€” creating the best remote storage for Prometheus</a></li>
</ul>
<h3 id="1æ›´å¥½çš„å‹ç¼©">1.æ›´å¥½çš„å‹ç¼©</h3>
<p>åœ¨TSDBçš„ä¸–ç•Œä¸­ï¼ŒGorillaå‹ç¼©ç®—æ³•æ˜¯ä¸€ä¸ªä¸šç•Œæ ‡å‡†ï¼ŒPrometheusã€Influxdbã€M3ç­‰éƒ½ä½¿ç”¨Gorillaã€‚</p>
<p>VictoriaMetricsåœ¨Gorillaçš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¼˜åŒ–ï¼ŒGorillaåœ¨å…¸å‹çš„æµ®ç‚¹æ•°çš„å¼‚æˆ–è¿ç®—åå¾—åˆ°çš„ç»“æœå…¶å®å¹¶ä¸å¦‚äººæ„ï¼ˆå‰åä»…æœ‰å°‘é‡çš„0ï¼‰ï¼Œå› æ­¤å‹ç¼©ç‡æ²¡æœ‰é‚£ä¹ˆé«˜ã€‚VictoriaMetricsçš„ä½œè€…å°†æµ®ç‚¹æ•°* 10^Nï¼Œå¾—åˆ°ä¸€ä¸ªæ•´æ•°ï¼Œæ•´æ•°ä¹‹é—´å¼‚æˆ–åå‹ç¼©ç‡è¦æ¯”æµ®ç‚¹æ•°é«˜å¾ˆå¤šã€‚é’ˆå¯¹æµ®ç‚¹æ•°ä¹˜ä»¥10^Nåå¯èƒ½è¶…è¿‡64ä½çš„é—®é¢˜ï¼Œå†å¯¹æ•´æ•°/10^Mä¿è¯æ‰€æœ‰time seriesçš„valueèƒ½è¢«è½¬æ¢ä¸º64ä½æ•´æ•°ã€‚</p>
<p>å°†Countersä½¿ç”¨delta-encodingè½¬æ¢ä¸ºGaugesï¼ˆåŒä¸€ä¸ªtime seriesä¸åŒtimestampçš„valueç”¨å¢é‡ä»£æ›¿åŸå§‹å€¼ï¼‰å‡å°‘å­˜å‚¨ç©ºé—´ã€‚</p>
<p>åœ¨ä¸Šå±‚ä½¿ç”¨ä¸€èˆ¬æ€§çš„å‹ç¼©ï¼Œæ¯”å¦‚zstdï¼ˆä¸€ç§å¿«é€Ÿçš„æ— æŸå‹ç¼©ç®—æ³•ï¼‰ï¼Œç”¨äºå‹ç¼©é‡å¤æ¨¡å¼å’Œä½ç†µçš„æ•°æ®ã€‚</p>
<h3 id="2data-structure">2.data structure</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r-- 1 root root   645052699 Apr 20 10:46 index.bin</span><br><span class="line">-rw-r--r-- 1 root root      784063 Apr 20 10:46 metaindex.bin</span><br><span class="line">-rw-r--r-- 1 root root  9521858864 Apr 20 10:46 timestamps.bin</span><br><span class="line">-rw-r--r-- 1 root root 20168371013 Apr 20 10:46 values.bin</span><br></pre></td></tr></table></figure>
<h3 id="3cache-structure">3.cache structure</h3>
<ul>
<li>/var/data/victoriametrics/vmstorage/cache</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r-- 1 root root 289722144 Jan 14 13:57 curr_hour_metric_ids</span><br><span class="line">drwx------ 2 root root      4096 Jan 14 13:57 date_metricID</span><br><span class="line">drwx------ 2 root root      4096 Jan 14 13:57 metricID_metricName</span><br><span class="line">drwx------ 2 root root      4096 Jan 14 13:57 metricID_tsid</span><br><span class="line">drwx------ 2 root root      4096 Jan 14 13:57 metricName_tsid</span><br><span class="line">-rw-r--r-- 1 root root 296396616 Jan 14 13:57 prev_hour_metric_ids</span><br></pre></td></tr></table></figure>
<ul>
<li>/var/data/victoriametrics/vmstorage/cache/metricID_tsid</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">-rw-r--r-- 1 root root 120183 Jan 14 13:57 data.6.bin</span><br><span class="line">-rw-r--r-- 1 root root 111710 Jan 14 13:57 data.7.bin</span><br><span class="line">-rw-r--r-- 1 root root  69297 Jan 14 13:57 data.8.bin</span><br><span class="line">-rw-r--r-- 1 root root 270344 Jan 14 13:57 data.9.bin</span><br><span class="line">-rw-r--r-- 1 root root      8 Jan 14 13:57 metadata.bin</span><br></pre></td></tr></table></figure>
<p><strong>vm fastcacheä¸ºä»€ä¹ˆå¿«ï¼Ÿ</strong></p>
<ol>
<li>cacheåˆ†ä¸ºå¤šä¸ªbucketï¼Œæ¯ä¸ªbucketæœ‰ä¸€æŠŠé”ï¼Œå¤šæ ¸cpuä¸‹å¯ä»¥æå‡å¹¶å‘è¯»å†™èƒ½åŠ›;</li>
<li>æ¯ä¸ªbucketåŒ…å«äº†è‹¥å¹²ä¸ªchunk(<code>chucks [][]byte</code>)ï¼Œæ¯ä¸ªchuck 64KBï¼Œå‡å°‘å†…å­˜ç¢ç‰‡ï¼Œåœ¨GBçº§åˆ«çš„cacheå¤§å°ä¸‹å¯ä»¥èŠ‚çœè‹¥å¹²ä¸ªGBçš„å†…å­˜;</li>
<li>chuckså°½å¯èƒ½å †å¤–åˆ†é…ï¼Œå› ä¸ºGoGCåœ¨æ— éœ€åšè°ƒæ•´çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æ›´é¢‘ç¹åœ°å›æ”¶ä¸ä½¿ç”¨çš„å†…å­˜ã€‚</li>
</ol>

	

	

</article>




	<article>
	
		<h1><a href="/article/mysql-install/">Centos7.3å®‰è£…Mysql8</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2020-03-07</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Mysql/">Mysql</a>
			</span>
		
	</div>

	

	
		<h2 id="centos7å®‰è£…mysql8">Centos7å®‰è£…Mysql8</h2>
<h3 id="1å®‰è£…">1.å®‰è£…</h3>
<ul>
<li>
<p>ç³»ç»Ÿç‰ˆæœ¬ï¼šCentos7</p>
</li>
<li>
<p>Mysqlç‰ˆæœ¬ï¼šMysql8.0</p>
</li>
<li>
<p>å®‰è£…æ–¹å¼ï¼šyum</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">wget https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm </span><br><span class="line"></span><br><span class="line">sudo rpm -Uvh mysql80-community-release-el7-3.noarch.rpm</span><br><span class="line"></span><br><span class="line">sudo yum install mysql-community-server</span><br><span class="line"></span><br><span class="line">sudo systemctl start mysqld.service</span><br><span class="line"></span><br><span class="line">sudo systemctl status mysqld.service</span><br></pre></td></tr></table></figure>
<h4 id="åˆ‡æ¢ç‰ˆæœ¬">åˆ‡æ¢ç‰ˆæœ¬</h4>
<p>å¦‚æœæƒ³è¦æ›´æ¢ç‰ˆæœ¬ï¼Œå¯ä»¥å…ˆæŸ¥çœ‹å½“å‰mysql yum repositoryä¸­æ‰€æœ‰mysqlç‰ˆæœ¬</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum repolist all | grep mysql</span><br></pre></td></tr></table></figure>
<p>åˆ‡æ¢ç‰ˆæœ¬</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --<span class="built_in">disable</span> mysql80-community</span><br><span class="line">sudo yum-config-manager --<span class="built_in">enable</span> mysql57-community</span><br></pre></td></tr></table></figure>
<h3 id="2ä¿®æ”¹å¯†ç ">2.ä¿®æ”¹å¯†ç </h3>
<ol>
<li>Mysqlç¬¬ä¸€æ¬¡å¯åŠ¨åä¼šåˆ›å»ºè¶…çº§ç®¡ç†å‘˜è´¦å·<code>root@localhost</code>ï¼Œåˆå§‹å¯†ç å­˜å‚¨åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo grep `temporary password` /var/<span class="built_in">log</span>/mysqld.log</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>ä¿®æ”¹é»˜è®¤å¯†ç </li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line"><span class="comment"># &gt; password: &lt;è¾“å…¥ä½ çš„åˆå§‹å¯†ç &gt;</span></span><br><span class="line">alter user <span class="string">'root'</span>@<span class="string">'localhost'</span> identified by <span class="string">'&lt;new password&gt;'</span></span><br><span class="line"><span class="comment"># æ³¨æ„è¿™é‡Œçš„æ–°å¯†ç éœ€è¦ç¬¦åˆç­–ç•¥ï¼ŒåŒ…å«æ•°å­—ã€å¤§å°å†™å­—æ¯ã€ç‰¹æ®Šå­—ç¬¦ã€‚</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>ä¿®æ”¹é»˜è®¤ç­–ç•¥</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; <span class="built_in">set</span> global validate_password_policy=0;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶å¯èƒ½æŠ¥é”™æç¤º</p>
<p><code>ERROR 1193 (HY000): Unknown system variable 'validate_password_policy'</code></p>
<p>åŸå› æ˜¯<code>validate_password_policy</code>é»˜è®¤æ²¡æœ‰è¢«æ¿€æ´»ï¼Œè§£å†³å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; select plugin_name, plugin_status from information_schema.plugins <span class="built_in">where</span> plugin_name like <span class="string">'validate%'</span>;</span><br><span class="line"></span><br><span class="line">mysql &gt; install plugin validate_password soname <span class="string">'validate_password.so'</span>;</span><br><span class="line"></span><br><span class="line">mysql &gt; mysql&gt; select plugin_name, plugin_status from information_schema.plugins <span class="built_in">where</span> plugin_name like <span class="string">'validate%'</span>;</span><br><span class="line"></span><br><span class="line">SHOW VARIABLES LIKE <span class="string">'validate_password%'</span>;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæŸ¥æ‰¾pluginä¸­æ˜¯å¦åŒ…å«validatexxxï¼Œè¿”å›empty setè¯´æ˜ä¸åŒ…å«ï¼Œå®‰è£…åå³å¯ï¼Œæ¥ç€é‡æ–°è¿è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; <span class="built_in">set</span> global validate_password_policy=0;</span><br><span class="line"></span><br><span class="line">mysql &gt; <span class="built_in">set</span> global validate_password_length=8;</span><br><span class="line"></span><br><span class="line">mysql &gt; alter user <span class="string">'root'</span>@<span class="string">'localhost'</span> identified by <span class="string">'12345678'</span>;</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹æˆåŠŸ</p>
<h3 id="3å…è®¸ç”¨æˆ·è¿œç¨‹è®¿é—®">3.å…è®¸ç”¨æˆ·è¿œç¨‹è®¿é—®</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; CREATE USER <span class="string">'test_user'</span>@<span class="string">'%'</span> IDENTIFIED BY <span class="string">'12345678'</span>;</span><br><span class="line"></span><br><span class="line">mysql &gt; GRANT ALL ON *.* TO <span class="string">'test_user'</span>@<span class="string">'%'</span>;</span><br><span class="line"></span><br><span class="line">mysql &gt; ALTER USER <span class="string">'test_user'</span>@<span class="string">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class="string">'12345678'</span>;</span><br><span class="line"></span><br><span class="line">mysql &gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<p>å®Œäº‹åIDEä¸‹æµ‹è¯•æ•°æ®åº“è¿æ¥æˆåŠŸï¼</p>

	

	

</article>




	<article>
	
		<h1><a href="/article/stdout&amp;stderr/">/dev/stdoutå’Œ/dev/stderræ˜¯ä»€ä¹ˆï¼Ÿ</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2020-03-07</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Linux/">Linux</a>
			</span>
		
	</div>

	

	
		<h2 id="linuxä¸­çš„devstdoutå’Œdevstderr">Linuxä¸­çš„/dev/stdoutå’Œ/dev/stderr</h2>
<p>In the <code>/dev</code> directory, amongst the disks, TTYs, <code>urandom</code>s, and other pseudo-devices, are the files <code>/dev/stdin</code>, <code>/dev/stdout</code> and <code>/dev/stderr</code>. What are they, and what are they good for?</p>
<p>You may have heard of standard in, standard out and standard error, the three â€œstandard streamsâ€ which each UNIX process usually has attached to it on start. For example, <code>cat</code> run with no arguments reads from standard in and writes to standard out (achieving nothing):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ echo hello | cat | tr &apos;[a-z]&apos; &apos;[A-Z]&apos;</span><br><span class="line">HELLO</span><br></pre></td></tr></table></figure>
<p>The standard streams donâ€™t seem like â€œdevicesâ€, but there they are in <code>/dev</code>; files which any process can open, read from, and write to, just like other files. When I write to <code>/dev/stdout</code> from my shell, itâ€™s printed to my terminal:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ echo hello &gt; /dev/stdout</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>
<p>Crucially, <code>/dev/stdout</code> means different things to different processes. Above, <code>/dev/stdout</code> refers to the standard out of my shell process, which is my terminal, and thatâ€™s why <code>hello</code> printed to my screen. But if I tell <code>cp</code> to write to <code>/dev/stdout</code>, it writes to its own standard out stream, not to my shellâ€™s standard out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ echo hello | cp /dev/stdin /dev/stdout | tr &apos;[a-z]&apos; &apos;[A-Z]&apos;</span><br><span class="line">HELLO</span><br></pre></td></tr></table></figure>
<p>Look at that: we got <code>cp</code>, normally used for copying files, to behave just like <code>cat</code>, which copies streams! We were able to do this by telling <code>cp</code> to use its standard streams instead of files.</p>
<p>When building shell pipelines, this can be very useful. The following pipeline grabs a JPEG from the web, converts it to a monochrome PNG, then posts the result to another web server, without creating any temporary files:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl https://upload.wikimedia.org/wikipedia/en/5/52/Testcard_F.jpg \</span><br><span class="line">| convert -monochrome /dev/stdin png:/dev/stdout \</span><br><span class="line">| curl -X POST --data @/dev/stdin -H &apos;Content-Type: image/png&apos; http://requestbin.fullcontact.com/13rcezq1</span><br></pre></td></tr></table></figure>
<p>Processes interact with files via file descriptors. When a process opens a file, the OS gives the process a file descriptor (a number) which the process can use to read or write from the open file. We can see this with <code>strace</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ cat foo.txt</span><br><span class="line">hello</span><br><span class="line">$ strace cat foo.txt</span><br><span class="line">...</span><br><span class="line">open(&quot;foo.txt&quot;, O_RDONLY)               = 3</span><br><span class="line">...</span><br><span class="line">read(3, &quot;hello\n&quot;, 65536)               = 6</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>Here, <code>cat foo.txt</code> called <code>open(&quot;foo.txt&quot;, O_RDONLY)</code>, and the OS returned the file descriptor <code>3</code>. <code>cat</code> then read from this with <code>read(3, ...)</code>.</p>
<p>The standard streams in, out and error are at file descriptors 0, 1 and 2 respectively. The standard streams are pre-attached; the process does not have to open them. For example, <code>cat</code> run with no arguments reads from file descriptor <code>0</code> and writes to file descriptor <code>1</code>. In a shell pipeline, these standard file descriptors are references to anonymous pipes.</p>
<p>When we run <code>cp /dev/stdin /dev/stdout</code>, the process opens the files <code>/dev/stdin</code> and <code>/dev/stdout</code> as normal, and gets back file descriptors for them. Which numbers do you think it gets back?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">open(&quot;/dev/stdin&quot;, O_RDONLY)            = 3</span><br><span class="line">open(&quot;/dev/stdout&quot;, O_WRONLY|O_TRUNC)   = 4</span><br></pre></td></tr></table></figure>
<p>No, it doesnâ€™t get back 0 and 1; it gets two <em>new</em> file descriptors 3 and 4. But those new file descriptors both refer to the same underlying anonymous pipe.</p>

	

	

</article>




	<article>
	
		<h1><a href="/article/maven-multi-mirror-md/">mavenå¤šé•œåƒæºé…ç½®</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2020-02-20</span><br />
		
		
	</div>

	

	
		<h3 id="åœºæ™¯">åœºæ™¯ï¼š</h3>
<ul>
<li>å¤§éƒ¨åˆ†jaråŒ…å¯ä»¥åœ¨å…¬å¸çš„maven mirroræ‰¾åˆ°ï¼Œä½†å°éƒ¨åˆ†jaråŒ…ä¸‹ä¸åˆ°</li>
<li>éœ€è¦ä¸€ä¸ªä¸»å¤‡å…³ç³»çš„mirrorï¼Œå½“éƒ¨åˆ†jaråœ¨ä¸»é•œåƒä¸­æ‰¾ä¸åˆ°æ—¶ï¼Œè‡ªåŠ¨å»å‰¯é•œåƒæ‰¾</li>
</ul>
<h3 id="æ–¹æ³•">æ–¹æ³•ï¼š</h3>
<blockquote>
<p>å‚è€ƒï¼š<a href="http://maven.apache.org/guides/mini/guide-mirror-settings.html" target="_blank" rel="noopener">http://maven.apache.org/guides/mini/guide-mirror-settings.html</a></p>
</blockquote>
<p>1.æ‰¾åˆ°settings.xmlå¹¶æ‰“å¼€</p>
<blockquote>
<p>macos : open  ~/.m2/settings.xml</p>
</blockquote>
<p>2.ä¿®æ”¹mirrors</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">name</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">		  <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-corp<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		  <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">		  <span class="tag">&lt;<span class="name">name</span>&gt;</span>public<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		  <span class="tag">&lt;<span class="name">url</span>&gt;</span>å…¬å¸çš„mavené•œåƒåœ°å€<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>æ³¨æ„</code>:</p>
<ul>
<li><code>mirrorOf</code>ä¸èƒ½æœ‰å¤šä¸ªmirroræœ‰ç›¸åŒçš„å€¼ï¼Œå¦åˆ™åªä¼šä½¿ç”¨ç¬¬ä¸€ä¸ªmirror</li>
</ul>

	

	

</article>




	<article>
	
		<h1><a href="/article/kafka-problem/">è®°ä¸€æ¬¡kafkaæ•…éšœ</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2019-10-15</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/kafka/">kafka</a>
			</span>
		
	</div>

	

	
		<h3 id="æ•…éšœæè¿°">æ•…éšœæè¿°</h3>
<blockquote>
<p>KafkaèŠ‚ç‚¹9092ç«¯å£å¥åº·ç›‘æµ‹çªç„¶redï¼Œå¹¶ä¸”åå¤é‡å¯æ— æ•ˆã€‚</p>
</blockquote>
<h3 id="é—®é¢˜åˆ†æ">é—®é¢˜åˆ†æ</h3>
<blockquote>
<p>è¯¥kafkaé›†ç¾¤ï¼Œç”±è‹¥å¹²ä¸ªç”¨æˆ·åŒæ—¶<code>ç›´æ¥</code>è¿›è¡Œæ•°æ®å†™å…¥ï¼Œå¯¼è‡´clientæ•°ç›®éå¸¸å·¨å¤§ï¼Œtcp connectionæ•°é‡ä¸€ç›´ç»´æŒhigh level (60k - 70k) ï¼›</p>
<p>å¤§å¹¶å‘é‡ä¸‹ï¼Œopen fileï¼ˆæ–‡ä»¶å¥æŸ„ï¼‰è¿‡å¤šï¼Œå¯¼è‡´èŠ‚ç‚¹åˆšèµ·æ¥çš„æ—¶å€™ç›´æ¥æ‰“çˆ†ulimité»˜è®¤é™åˆ¶ã€‚</p>
</blockquote>
<h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3>
<h4 id="æ–¹æ¡ˆ1iptablesæ‰¹é‡æ”¾å¼€è¿æ¥è®©è¿æ¥æ…¢æ…¢åˆ†æ‘Šåˆ°åˆ«çš„èŠ‚ç‚¹ä¸Š">æ–¹æ¡ˆ1ï¼šiptablesæ‰¹é‡æ”¾å¼€è¿æ¥ï¼Œè®©è¿æ¥æ…¢æ…¢åˆ†æ‘Šåˆ°åˆ«çš„èŠ‚ç‚¹ä¸Š</h4>
<p>(1) é€šè¿‡iptableså’Œipseté™åˆ¶ç«¯å£è®¿é—®é‡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/bin/bash</span></span><br><span class="line"></span><br><span class="line">yum -y install ipset</span><br><span class="line"></span><br><span class="line">ipset create nodes <span class="built_in">hash</span>:ip </span><br><span class="line"></span><br><span class="line">netstat -anp|grep xx.xx.xxx.xx:9092 |awk &#123;<span class="string">'print $5'</span>&#125;|head -10000|sort -n| uniq |cut -f4 -d<span class="string">":"</span> &gt; kafka-ip.txt</span><br><span class="line"></span><br><span class="line">cat kafka-ipv4.txt | <span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">	ipset add nodes <span class="variable">$line</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">iptables -I INPUT -m <span class="built_in">set</span> --match-set nodes src -p tcp --destination-port 9092 -j DROP</span><br><span class="line">service iptables save</span><br></pre></td></tr></table></figure>
<p>(2) supervisordå¯åŠ¨kafka</p>
<p><code>supervisorctl restart kafka</code></p>
<p>(3) ipset remove ip</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq 2 2000 10000`</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">	start=<span class="variable">$i</span></span><br><span class="line">	end=`expr <span class="variable">$i</span>+2000`</span><br><span class="line">  sed -n <span class="string">'/$start,$end/p'</span> kafka-ip.txt | <span class="keyword">while</span> <span class="built_in">read</span> line </span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    ipset del nodes <span class="variable">$line</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  sleep 2m</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">service iptables save</span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure>
<p>(3) å…³é—­é˜²ç«å¢™</p>
<p><code>service iptables stop</code><br>
æ­¤æ—¶èŠ‚ç‚¹å·²æ¢å¤.</p>
<h4 id="æ–¹æ¡ˆ2ä¿®æ”¹ulimité™åˆ¶">æ–¹æ¡ˆ2ï¼šä¿®æ”¹ulimité™åˆ¶</h4>
<p>ç¬¬ä¸€ç§ï¼šä¸´æ—¶ä¿®æ”¹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„é™åˆ¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos 6 ç‰ˆæœ¬çš„æœºå™¨</span></span><br><span class="line">$ <span class="built_in">echo</span> -n <span class="string">'Max open files=1048576:1048576'</span> &gt; /proc/&lt;PID&gt;/limits</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos 7 ç‰ˆæœ¬çš„æœºå™¨</span></span><br><span class="line">$ prlimit --nofile=1048576:1048576 --pid 130328</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç¼ºé™·æ˜¯ä¸€æ—¦è¿›ç¨‹å†ä¸€æ¬¡æŒ‚æ‰ï¼Œé‡æ–°èµ·æ¥çš„æ—¶å€™max open fileä¾ç„¶æ˜¯é»˜è®¤å€¼ã€‚</p>
</blockquote>
<p>ç¬¬äºŒç§ï¼šä¿®æ”¹ç³»ç»Ÿé…ç½®ï¼Œé‡å¯supervisorå’Œkafkaåæ°¸ä¹…ç”Ÿæ•ˆ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä¿®æ”¹ /etc/security/limits.conf</span><br><span class="line">å¢åŠ  * - nofile 1048576(æœ€å¤§æ–‡ä»¶å¥æŸ„æ•°é‡) è¿™è¡Œ</span><br><span class="line"></span><br><span class="line">ä¿®æ”¹ /etc/security/limits.d/90-nproc.conf æˆ–è€… /etc/security/limits.d/20-nproc.conf</span><br><span class="line">å¢åŠ  * - nofile 1048576(æœ€å¤§æ–‡ä»¶å¥æŸ„æ•°é‡) è¿™è¡Œ</span><br></pre></td></tr></table></figure>

	

	

</article>




	<article>
	
		<h1><a href="/article/Prometheus/">PromQLå®ç°ä¸€äº›å¤æ‚å‡½æ•°åŠŸèƒ½</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2019-10-10</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Prometheus/">Prometheus</a>
			</span>
		
	</div>

	

	
		<h2 id="graphite-functions-in-promql">graphite functions in PromQL</h2>
<p><code>highestMax</code>, <code>mostDeviant</code>è¿™ç§éœ€è¦å¤šæ­¥éª¤è¿‡æ»¤çš„æ–¹æ³•åœ¨<code>PromQL</code>ä¸­çš„ä¸€ä¸ªåŸºæœ¬æ€è·¯æ˜¯</p>
<blockquote>
<ol>
<li>å±•ç¤ºéœ€è¦çš„æ•°æ®</li>
<li>and on ( tag )</li>
<li>è¿‡æ»¤æ¡ä»¶</li>
</ol>
</blockquote>
<blockquote>
<p><code>vector1 and vector2</code> results in a vector consisting of the elements of <code>vector1</code> for which there are elements in <code>vector2</code> with exactly matching label sets. Other elements are dropped. The metric name and values are carried over from the <code>left-hand side vector</code>.<br>
ä¸€å¥è¯:  <code>and</code> å·¦æ‰‹è¾¹çš„å†³å®šæŒ‡æ ‡åç§°å’Œå€¼, å³æ‰‹è¾¹çš„å†³å®šè¿‡æ»¤æ¡ä»¶.</p>
</blockquote>
<h3 id="highestmax-promql-example"><code>highestMax</code> PromQL example</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># show max value grouped by `endpoint`(ignore `device` tag)</span><br><span class="line">max(</span><br><span class="line">    clamp_max(sys.io.util_value&#123;env=&apos;elasticsearch&apos;, appid =&apos;100012314&apos;&#125;, 100 )</span><br><span class="line">) by (appid, pool, endpoint)</span><br><span class="line"></span><br><span class="line"># join on `endpoint`</span><br><span class="line">and on ( endpoint )</span><br><span class="line"></span><br><span class="line"># filtering</span><br><span class="line">limitk(10, </span><br><span class="line">  sort_desc(</span><br><span class="line">    range_max(</span><br><span class="line">    	  clamp_max(sys.io.util_value&#123;env=&apos;elasticsearch&apos;, appid =&apos;100012314&apos;&#125;, 100)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="mostdeviant-promql-example"><code>mostDeviant</code> PromQL example</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">WITH(</span><br><span class="line">  mostDeviant(k,selector)=selector and on (ip)</span><br><span class="line">  limitk(k,sort_desc(</span><br><span class="line">    running_avg(sum2_over_time(selector-range_avg(selector)))</span><br><span class="line">  ))</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">mostDeviant($metric_number,app.appid.ip.error.count_value&#123;appid=&apos;$appid&apos;&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="highestaverage-promql-example"><code>highestAverage</code> PromQL example</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">WITH(</span><br><span class="line">  mostDeviant(k,selector)=selector and on (endpoint)</span><br><span class="line">  limitk(k,sort_desc(</span><br><span class="line">    range_avg(selector)</span><br><span class="line">  ))</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">mostDeviant(20,k8s.node.network.packet_kernel_drop_value&#123;endpoint=&apos;$host&apos;&#125;)</span><br></pre></td></tr></table></figure>

	

	

</article>




	<article>
	
		<h1><a href="/article/systemd/">Systemdä½¿ç”¨æŠ€å·§</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2019-10-09</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Linux/">Linux</a>
			</span>
		
	</div>

	

	
		<h1 id="systemd">systemd</h1>
<p>systemdçš„ä¸€äº›ç®€å•ä½¿ç”¨æŠ€å·§</p>
<h2 id="åŸºæœ¬å‘½ä»¤">åŸºæœ¬å‘½ä»¤</h2>
<p><code>systemctl</code> å‘½ä»¤:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">systemctl status &lt;service_name&gt;         # æ£€æŸ¥æœåŠ¡çš„çŠ¶æ€</span><br><span class="line">systemctl start &lt;service_name&gt;          # å¯åŠ¨æœåŠ¡</span><br><span class="line">systemctl stop &lt;service_name&gt;           # åœæ­¢æœåŠ¡</span><br><span class="line">systemctl enable &lt;service_name&gt;         # enableæœåŠ¡, ç®€å•è®², è®©æœåŠ¡å¼€æœºå°±è·‘èµ·æ¥, å…·ä½“ç­–ç•¥æŒ‰æœåŠ¡çš„é…ç½®æ¥.</span><br><span class="line">systemctl disable &lt;service_name&gt;        # disableæœåŠ¡, ç®€å•è®²å°±æ˜¯æœåŠ¡ä¸å†è‡ªåŠ¨æŒ‰ç…§è§„å®šç­–ç•¥æ¥è·‘äº†, ä½†ä¸ä¼šåœæ­¢ç°åœ¨å·²ç»è·‘èµ·æ¥çš„æœåŠ¡.</span><br><span class="line">systemctl --daemon-reload               # é‡æ–°åŠ è½½systemdçš„æœåŠ¡åˆ—è¡¨, å®‰è£…å’Œä¿®æ”¹`xxx.service`éœ€è¦ç”¨</span><br></pre></td></tr></table></figure>
<p><code>journalctl</code>å‘½ä»¤: (#TODO)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl                              #å¯ä»¥ç”¨æ¥çœ‹æ—¥å¿— (TODO)</span><br></pre></td></tr></table></figure>
<h2 id="service-template">service template</h2>
<p>ä¸‹è¾¹æ˜¯ä¸€ä¸ªé€šè¿‡systemdæ¥æŠŠä¸€äº›linuxä¸‹çš„long runningçš„è¿›ç¨‹å¿«é€Ÿé…ç½®æˆæœåŠ¡å˜é€šçš„åŠæ³•.</p>
<ol>
<li>å…ˆå‡†å¤‡ä¸€ä¸ªbashè„šæœ¬, ç”¨æ¥long runningçš„æ–¹å¼å¯åŠ¨åº”ç”¨.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># start.sh example.</span></span><br><span class="line"><span class="comment"># <span class="doctag">NOTE:</span> use absolute path</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/usr/bin/sh</span></span><br><span class="line">PROOT=<span class="string">"<span class="variable">$( cd "$(dirname "$0")</span>"</span> ; <span class="built_in">pwd</span> -P )<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"><span class="variable">$PROOT</span>/bin/prometheus \</span></span><br><span class="line"><span class="string">        --storage.tsdb.path="</span>/var/data/prometheus/<span class="string">" \</span></span><br><span class="line"><span class="string">        --config.file="</span><span class="variable">$PROOT</span>/conf/prometheus.yml<span class="string">"</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>ç„¶åæŠŠä¸‹è¾¹çš„æ¨¡æ¿æ”¹æ”¹, ä¿å­˜æˆ <code>xxxx.service</code> æ”¾åˆ° <code>/etc/systemd/system/</code> ä¸‹.  è¿™ä¸ªæ”¾çš„ä½ç½®æ¯”è¾ƒè¾ƒç²—ç³™.</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=prometheus</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/bin/sh -c &apos;/home/oliveagle/app/prometheus/start.sh 2&gt;&amp;1&apos;</span><br><span class="line">User=oliveagle</span><br><span class="line">Group=oliveagle</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=10</span><br><span class="line"># restart service every xxx seconds.</span><br><span class="line"># RuntimeMaxSec=604800</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line"># NOTE: use default.target</span><br><span class="line">WantedBy=default.target</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>é€šè¿‡<code>systemctl</code>å‘½ä»¤åŠ è½½, å®‰è£…, å¯åŠ¨</li>
</ol>

	

	

</article>




	<article>
	
		<h1><a href="/article/Linux-websites/">ä¸€äº›æœ‰è¶£çš„Linuxç½‘ç«™</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2019-10-07</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Linux/">Linux</a>
			</span>
		
	</div>

	

	
		<h2 id="ä¸€äº›æœ‰è¶£çš„linuxç½‘ç«™">ä¸€äº›æœ‰è¶£çš„Linuxç½‘ç«™</h2>
<ul>
<li><a href="https://github.com/aleksandar-todorovic/awesome-linux" target="_blank" rel="noopener">awesome-linuxåˆ—è¡¨</a> - github ä¸Š awesome-linux åˆ—è¡¨ï¼Œé‡Œè¾¹å„ç§linuxç›¸å…³çš„ç½‘ç«™</li>
<li><a href="https://github.com/geekwolf/free-books/blob/master/free-programming-books.md" target="_blank" rel="noopener">free-programming-books</a> - å¾ˆå¤šå¼€å‘ç›¸å…³çš„å…è´¹ä¹¦ç±</li>
<li><a href="https://bootlin.com/docs/" target="_blank" rel="noopener">bootlin.com</a> - linux å†…æ ¸ç›¸å…³
<ul>
<li><a href="https://elixir.bootlin.com/linux/v5.4/source" target="_blank" rel="noopener">elixir.bootlin.com</a> - linux kernal æºç æµè§ˆ</li>
</ul>
</li>
<li><a href="https://distrowatch.com/" target="_blank" rel="noopener">distrowatch.com</a> - linux å„å‘è¡Œç‰ˆçš„ä¿¡æ¯</li>
<li><a href="https://www.commandlinefu.com/commands/browse" target="_blank" rel="noopener">commandlinefu.com</a> - linux å‘½ä»¤æ”¶é›†ç½‘ç«™</li>
<li><a href="https://explainshell.com/#" target="_blank" rel="noopener">explainshell.com</a> - è§£é‡Šshellå‘½ä»¤çš„ç½‘ç«™</li>
<li><a href="https://www.shortcutfoo.com/" target="_blank" rel="noopener">shortcutfoo.com</a> - ç»ƒä¹ shortcutçš„ç½‘ç«™</li>
<li><a href="http://vim-adventures.com/" target="_blank" rel="noopener">vim-adventures.com</a> - é€šè¿‡RPGæ¸¸æˆæ¥è”ç³»VIMçš„ä½¿ç”¨</li>
<li><a href="http://tldp.org/LDP/Bash-Beginners-Guide/html/index.html" target="_blank" rel="noopener">Bash Guide for Beginners</a> - Bash Guide for Beginners</li>
<li><a href="https://coolshell.cn/" target="_blank" rel="noopener">coolshellç½‘ç«™</a> - é…·å£³</li>
<li><a href="https://github.com/peco/peco" target="_blank" rel="noopener">https://github.com/peco/peco</a> - éå¸¸ç®€å•å¥½ç”¨çš„äº¤äº’å¼è¿‡æ»¤å·¥å…·</li>
<li><a href="https://www.openvim.com/" target="_blank" rel="noopener">https://www.openvim.com/</a> - Interactive vim tutorial</li>
</ul>

	

	

</article>




	<article>
	
		<h1><a href="/article/Docker_commands/">Dockerå‘½ä»¤å¿«é€Ÿå…¥é—¨</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2019-10-05</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Docker/">Docker</a>
			</span>
		
	</div>

	

	
		<h2 id="dockerç¯å¢ƒå®‰è£…">Dockerç¯å¢ƒå®‰è£…</h2>
<ul>
<li>centoså®‰è£…docker</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install docker</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯åŠ¨Docker</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>
<h2 id="dockeré•œåƒå¸¸ç”¨å‘½ä»¤">Dockeré•œåƒå¸¸ç”¨å‘½ä»¤</h2>
<h4 id="ä¸‹è½½é•œåƒ">ä¸‹è½½é•œåƒ</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull alpine:3.8</span><br></pre></td></tr></table></figure>
<h4 id="åˆ—å‡ºé•œåƒ">åˆ—å‡ºé•œåƒ</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>
<h4 id="åˆ é™¤é•œåƒ">åˆ é™¤é•œåƒ</h4>
<ul>
<li>æŒ‡å®šåç§°åˆ é™¤é•œåƒ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi alpine:3.8</span><br></pre></td></tr></table></figure>
<ul>
<li>æŒ‡å®šåç§°åˆ é™¤é•œåƒï¼ˆå¼ºåˆ¶ï¼‰</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f alpine:3.8</span><br></pre></td></tr></table></figure>
<h2 id="dockerå®¹å™¨å¸¸ç”¨å‘½ä»¤">Dockerå®¹å™¨å¸¸ç”¨å‘½ä»¤</h2>
<h4 id="æ–°å»ºå¹¶å¯åŠ¨å®¹å™¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ä¸€ä¸ªbashç»ˆç«¯å…è®¸ç”¨æˆ·è¿›è¡Œäº¤äº’">æ–°å»ºå¹¶å¯åŠ¨å®¹å™¨ï¼ˆä»¥ä¸‹å‘½ä»¤å¯åŠ¨ä¸€ä¸ªbashç»ˆç«¯ï¼Œå…è®¸ç”¨æˆ·è¿›è¡Œäº¤äº’ï¼‰</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -vï¼ˆä¸»æœºè¦å…±äº«çš„ç›®å½•ï¼‰:ï¼ˆå®¹å™¨ä¸ŠåŒæ­¥çš„ç›®å½•ï¼‰--name ï¼ˆæŒ‡å®šæ•°æ®å·å®¹å™¨çš„åç§°ï¼‰-i -t xxxx:xxxx  /bin/bash</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­,<code>-i</code>è®©å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¿æŒæ‰“å¼€ï¼Œ<code>-t</code>è®©Dockeråˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯å¹¶ç»‘å®šåˆ°å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¸Šï¼Œ<code>--name</code>ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ã€‚</p>
<h4 id="å¯åŠ¨å®¹å™¨2">å¯åŠ¨å®¹å™¨2</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 80:80 --name [æŒ‡å®šå®¹å™¨åç§°] -d [é•œåƒ]</span><br></pre></td></tr></table></figure>
<ul>
<li>-dé€‰é¡¹ï¼šè¡¨ç¤ºåå°è¿è¡Œ</li>
<li>-pé€‰é¡¹ï¼šæŒ‡å®šç«¯å£æ˜ å°„ï¼Œæœ¬æœº80ç«¯å£æ˜ å°„åˆ°å®¹å™¨80ç«¯å£</li>
</ul>
<h4 id="åˆ—å‡ºå®¹å™¨">åˆ—å‡ºå®¹å™¨</h4>
<ul>
<li>åˆ—å‡ºè¿è¡Œä¸­çš„å®¹å™¨</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>
<ul>
<li>åˆ—å‡ºæ‰€æœ‰å®¹å™¨</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>
<h4 id="åœæ­¢å®¹å™¨">åœæ­¢å®¹å™¨</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># $ContainerNameåŠ$ContainerIdå¯ä»¥ç”¨docker pså‘½ä»¤æŸ¥è¯¢å‡ºæ¥</span><br><span class="line">docker stop $ContainerName(æˆ–è€…$ContainerId)</span><br></pre></td></tr></table></figure>
<h4 id="å¼ºåˆ¶åœæ­¢å®¹å™¨">å¼ºåˆ¶åœæ­¢å®¹å™¨</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker kill $ContainerName(æˆ–è€…$ContainerId)</span><br></pre></td></tr></table></figure>
<h4 id="å¯åŠ¨å·²åœæ­¢çš„å®¹å™¨">å¯åŠ¨å·²åœæ­¢çš„å®¹å™¨</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start $ContainerName(æˆ–è€…$ContainerId)</span><br></pre></td></tr></table></figure>
<h4 id="è¿›å…¥å®¹å™¨å†…éƒ¨çš„bash">è¿›å…¥å®¹å™¨å†…éƒ¨çš„bash</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it $ContainerName /bin/bash</span><br></pre></td></tr></table></figure>
<h4 id="åˆ é™¤å®¹å™¨">åˆ é™¤å®¹å™¨</h4>
<ul>
<li>åˆ é™¤æŒ‡å®šå®¹å™¨</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm $ContainerName(æˆ–è€…$ContainerId)</span><br></pre></td></tr></table></figure>
<ul>
<li>å¼ºåˆ¶åˆ é™¤æ‰€æœ‰å®¹å™¨</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm -f $(docker ps -a -q)</span><br></pre></td></tr></table></figure>
<h4 id="æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—">æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs $ContainerName(æˆ–è€…$ContainerId)</span><br></pre></td></tr></table></figure>
<h4 id="æŸ¥çœ‹å®¹å™¨çš„ipåœ°å€">æŸ¥çœ‹å®¹å™¨çš„ipåœ°å€</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect --format &apos;&#123;&#123; .NetworkSettings.IPAddress &#125;&#125;&apos; $ContainerName(æˆ–è€…$ContainerId)</span><br></pre></td></tr></table></figure>
<h4 id="åŒæ­¥å®¿ä¸»æœºæ—¶é—´åˆ°å®¹å™¨">åŒæ­¥å®¿ä¸»æœºæ—¶é—´åˆ°å®¹å™¨</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp /etc/localtime $ContainerName(æˆ–è€…$ContainerId):/etc/</span><br></pre></td></tr></table></figure>
<h4 id="åœ¨å®¿ä¸»æœºæŸ¥çœ‹dockerä½¿ç”¨cpu-å†…å­˜-ç½‘ç»œ-ioæƒ…å†µ">åœ¨å®¿ä¸»æœºæŸ¥çœ‹dockerä½¿ç”¨cpuã€å†…å­˜ã€ç½‘ç»œã€ioæƒ…å†µ</h4>
<ul>
<li>æŸ¥çœ‹æŒ‡å®šå®¹å™¨æƒ…å†µï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats $ContainerName(æˆ–è€…$ContainerId)</span><br></pre></td></tr></table></figure>
<ul>
<li>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨æƒ…å†µï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats -a</span><br></pre></td></tr></table></figure>
<h3 id="docker-run">docker run</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">Usage:  docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br><span class="line"></span><br><span class="line">Run a command in a new container</span><br><span class="line">[root@SVR29295HW1288 admin]# docker run --help</span><br><span class="line"></span><br><span class="line">Usage:	docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br><span class="line"></span><br><span class="line">Run a command in a new container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --add-host list                  Add a custom host-to-IP mapping (host:ip)</span><br><span class="line">  -a, --attach list                    Attach to STDIN, STDOUT or STDERR</span><br><span class="line">      --blkio-weight uint16            Block IO (relative weight), between 10 and 1000, or 0 to disable (default 0)</span><br><span class="line">      --blkio-weight-device list       Block IO weight (relative device weight) (default [])</span><br><span class="line">      --cap-add list                   Add Linux capabilities</span><br><span class="line">      --cap-drop list                  Drop Linux capabilities</span><br><span class="line">      --cgroup-parent string           Optional parent cgroup for the container</span><br><span class="line">      --cidfile string                 Write the container ID to the file</span><br><span class="line">      --cpu-period int                 Limit CPU CFS (Completely Fair Scheduler) period</span><br><span class="line">      --cpu-quota int                  Limit CPU CFS (Completely Fair Scheduler) quota</span><br><span class="line">      --cpu-rt-period int              Limit CPU real-time period in microseconds</span><br><span class="line">      --cpu-rt-runtime int             Limit CPU real-time runtime in microseconds</span><br><span class="line">  -c, --cpu-shares int                 CPU shares (relative weight)</span><br><span class="line">      --cpus decimal                   Number of CPUs</span><br><span class="line">      --cpuset-cpus string             CPUs in which to allow execution (0-3, 0,1)</span><br><span class="line">      --cpuset-mems string             MEMs in which to allow execution (0-3, 0,1)</span><br><span class="line">  -d, --detach                         Run container in background and print container ID</span><br><span class="line">      --detach-keys string             Override the key sequence for detaching a container</span><br><span class="line">      --device list                    Add a host device to the container</span><br><span class="line">      --device-cgroup-rule list        Add a rule to the cgroup allowed devices list</span><br><span class="line">      --device-read-bps list           Limit read rate (bytes per second) from a device (default [])</span><br><span class="line">      --device-read-iops list          Limit read rate (IO per second) from a device (default [])</span><br><span class="line">      --device-write-bps list          Limit write rate (bytes per second) to a device (default [])</span><br><span class="line">      --device-write-iops list         Limit write rate (IO per second) to a device (default [])</span><br><span class="line">      --disable-content-trust          Skip image verification (default true)</span><br><span class="line">      --dns list                       Set custom DNS servers</span><br><span class="line">      --dns-option list                Set DNS options</span><br><span class="line">      --dns-search list                Set custom DNS search domains</span><br><span class="line">      --entrypoint string              Overwrite the default ENTRYPOINT of the image</span><br><span class="line">  -e, --env list                       Set environment variables</span><br><span class="line">      --env-file list                  Read in a file of environment variables</span><br><span class="line">      --expose list                    Expose a port or a range of ports</span><br><span class="line">      --group-add list                 Add additional groups to join</span><br><span class="line">      --health-cmd string              Command to run to check health</span><br><span class="line">      --health-interval duration       Time between running the check (ms|s|m|h) (default 0s)</span><br><span class="line">      --health-retries int             Consecutive failures needed to report unhealthy</span><br><span class="line">      --health-start-period duration   Start period for the container to initialize before starting</span><br><span class="line">                                       health-retries countdown (ms|s|m|h) (default 0s)</span><br><span class="line">      --health-timeout duration        Maximum time to allow one check to run (ms|s|m|h) (default 0s)</span><br><span class="line">      --help                           Print usage</span><br><span class="line">  -h, --hostname string                Container host name</span><br><span class="line">      --init                           Run an init inside the container that forwards signals and reaps processes</span><br><span class="line">  -i, --interactive                    Keep STDIN open even if not attached</span><br><span class="line">      --ip string                      IPv4 address (e.g., 172.30.100.104)</span><br><span class="line">      --ip6 string                     IPv6 address (e.g., 2001:db8::33)</span><br><span class="line">      --ipc string                     IPC mode to use</span><br><span class="line">      --isolation string               Container isolation technology</span><br><span class="line">      --kernel-memory bytes            Kernel memory limit</span><br><span class="line">  -l, --label list                     Set meta data on a container</span><br><span class="line">      --label-file list                Read in a line delimited file of labels</span><br><span class="line">      --link list                      Add link to another container</span><br><span class="line">      --link-local-ip list             Container IPv4/IPv6 link-local addresses</span><br><span class="line">      --log-driver string              Logging driver for the container</span><br><span class="line">      --log-opt list                   Log driver options</span><br><span class="line">      --mac-address string             Container MAC address (e.g., 92:d0:c6:0a:29:33)</span><br><span class="line">  -m, --memory bytes                   Memory limit</span><br><span class="line">      --memory-reservation bytes       Memory soft limit</span><br><span class="line">      --memory-swap bytes              Swap limit equal to memory plus swap: &apos;-1&apos; to enable unlimited swap</span><br><span class="line">      --memory-swappiness int          Tune container memory swappiness (0 to 100) (default -1)</span><br><span class="line">      --mount mount                    Attach a filesystem mount to the container</span><br><span class="line">      --name string                    Assign a name to the container</span><br><span class="line">      --network string                 Connect a container to a network (default &quot;default&quot;)</span><br><span class="line">      --network-alias list             Add network-scoped alias for the container</span><br><span class="line">      --no-healthcheck                 Disable any container-specified HEALTHCHECK</span><br><span class="line">      --oom-kill-disable               Disable OOM Killer</span><br><span class="line">      --oom-score-adj int              Tune host&apos;s OOM preferences (-1000 to 1000)</span><br><span class="line">      --pid string                     PID namespace to use</span><br><span class="line">      --pids-limit int                 Tune container pids limit (set -1 for unlimited)</span><br><span class="line">      --privileged                     Give extended privileges to this container</span><br><span class="line">  -p, --publish list                   Publish a container&apos;s port(s) to the host</span><br><span class="line">  -P, --publish-all                    Publish all exposed ports to random ports</span><br><span class="line">      --read-only                      Mount the container&apos;s root filesystem as read only</span><br><span class="line">      --restart string                 Restart policy to apply when a container exits (default &quot;no&quot;)</span><br><span class="line">      --rm                             Automatically remove the container when it exits</span><br><span class="line">      --runtime string                 Runtime to use for this container</span><br><span class="line">      --security-opt list              Security Options</span><br><span class="line">      --shm-size bytes                 Size of /dev/shm</span><br><span class="line">      --sig-proxy                      Proxy received signals to the process (default true)</span><br><span class="line">      --stop-signal string             Signal to stop a container (default &quot;SIGTERM&quot;)</span><br><span class="line">      --stop-timeout int               Timeout (in seconds) to stop a container</span><br><span class="line">      --storage-opt list               Storage driver options for the container</span><br><span class="line">      --sysctl map                     Sysctl options (default map[])</span><br><span class="line">      --tmpfs list                     Mount a tmpfs directory</span><br><span class="line">  -t, --tty                            Allocate a pseudo-TTY</span><br><span class="line">      --ulimit ulimit                  Ulimit options (default [])</span><br><span class="line">  -u, --user string                    Username or UID (format: &lt;name|uid&gt;[:&lt;group|gid&gt;])</span><br><span class="line">      --userns string                  User namespace to use</span><br><span class="line">      --uts string                     UTS namespace to use</span><br><span class="line">  -v, --volume list                    Bind mount a volume</span><br><span class="line">      --volume-driver string           Optional volume driver for the container</span><br><span class="line">      --volumes-from list              Mount volumes from the specified container(s)</span><br><span class="line">  -w, --workdir string                 Working directory inside the container</span><br></pre></td></tr></table></figure>

	

	

</article>




	<article>
	
		<h1><a href="/article/Springæºç è§£è¯»(ä¸€)/">Springæºç é˜…è¯»ç¬”è®°(ä¸€)</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2019-10-03</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/spring/">spring</a>
			</span>
		
	</div>

	

	
		<h2 id="springæºç é˜…è¯»ç¬”è®°ä¸€">Springæºç é˜…è¯»ç¬”è®°(ä¸€)</h2>
<h3 id="1-beanå·¥ç¨‹">1. Beanå·¥ç¨‹</h3>
<h4 id="1-defaultlistenablebeanfactory">(1) DefaultListenableBeanFactory</h4>
<p><figure class="figure"><img src="/img/article/spring/DefaultListableBeanFactory.png" alt=""></figure></p>
<h4 id="2-xmlbeandefinitionreader">(2) XmlBeanDefinitionReader</h4>
<p>ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ æ­¥çš„å¤„ç†ï¼š</p>
<ul>
<li>é€šè¿‡ç»§æ‰¿è‡ªAbstractBeanDefinitionReaderä¸­çš„æ–¹æ³•ï¼Œæ¥ä½¿ç”¨ResourceLoaderå°†èµ„æºæ–‡ä»¶è·¯å¾„è½¬æ¢ä¸ºå¯¹åº”çš„Resoureæ–‡ä»¶ï¼›</li>
<li>é€šè¿‡DocumentLoaderå¯¹Resourceæ–‡ä»¶è¿›è¡Œè½¬æ¢ï¼Œå°†Resourceæ–‡ä»¶è½¬æ¢ä¸ºDocumentæ–‡ä»¶ï¼›</li>
<li>é€šè¿‡å®ç°æ¥å£BeanDefinitionDocumentReaderçš„DefaultBeanDefinitionDocumentReaderç±»å¯¹Documentè¿›è¡Œè§£æï¼Œå¹¶ä½¿ç”¨BeanDefinitionParserDelegateå¯¹Elementè¿›è¡Œè§£æã€‚</li>
</ul>
<h4 id="3-xmlbeanfactory">(3) XmlBeanFactory</h4>
<ul>
<li>æ„é€ Resourceèµ„æºæ–‡ä»¶çš„å®ä¾‹å¯¹è±¡</li>
<li><code>this.reader.loadBeanDefinitions(resource)</code>å®Œæˆèµ„æºåŠ è½½</li>
</ul>
<h5 id="resourceæ˜¯å¦‚ä½•å°è£…çš„å‘¢"><code>Resourceæ˜¯å¦‚ä½•å°è£…çš„å‘¢ï¼Ÿ</code></h5>
<p>Resourceæ¥å£æŠ½è±¡äº†æ‰€æœ‰Springå†…éƒ¨ä½¿ç”¨åˆ°çš„åº•å±‚èµ„æºï¼ŒåŒ…æ‹¬ï¼šFile/URL/Classpathç­‰ï¼Œå¹¶ä¸”æä¾›äº†å­˜åœ¨æ€§ã€å¯è¯»æ€§ã€æ˜¯å¦å¤„äºæ‰“å¼€çŠ¶æ€ç­‰æ–¹æ³•ï¼Œæä¾›äº†ä¸åŒèµ„æºåˆ°URL/URI/Fileç±»å‹çš„è½¬æ¢ï¼Œä»¥åŠåŸºäºå½“å‰èµ„æºåˆ›å»ºä¸€ä¸ªç›¸å¯¹èµ„æºçš„æ–¹æ³•ã€‚</p>
<ul>
<li>
<p><code>loadBeanDefinitions</code> â€”&gt; <code>doBeanDefinitions</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">			Document doc = doLoadDocument(inputSource, resource);</span><br><span class="line">			<span class="keyword">int</span> count = registerBeanDefinitions(doc, resource);</span><br><span class="line">			<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">				logger.debug(<span class="string">"Loaded "</span> + count + <span class="string">" bean definitions from "</span> + resource);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> count;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (BeanDefinitionStoreException ex) &#123;</span><br><span class="line">			<span class="keyword">throw</span> ex;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (SAXParseException ex) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> XmlBeanDefinitionStoreException(resource.getDescription(),</span><br><span class="line">					<span class="string">"Line "</span> + ex.getLineNumber() + <span class="string">" in XML document from "</span> + resource + <span class="string">" is invalid"</span>, ex);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (SAXException ex) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> XmlBeanDefinitionStoreException(resource.getDescription(),</span><br><span class="line">					<span class="string">"XML document from "</span> + resource + <span class="string">" is invalid"</span>, ex);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (ParserConfigurationException ex) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> BeanDefinitionStoreException(resource.getDescription(),</span><br><span class="line">					<span class="string">"Parser configuration exception parsing XML from "</span> + resource, ex);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> BeanDefinitionStoreException(resource.getDescription(),</span><br><span class="line">					<span class="string">"IOException parsing XML document from "</span> + resource, ex);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> BeanDefinitionStoreException(resource.getDescription(),</span><br><span class="line">					<span class="string">"Unexpected exception parsing XML document from "</span> + resource, ex);</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<p><code>doBeanDefinitions</code>çš„ä¸»è¦å·¥ä½œï¼š</p>
<ul>
<li>
<p>è·å–XMLçš„éªŒè¯æ¨¡å¼</p>
</li>
<li>
<p>åŠ è½½XMLæ–‡ä»¶ï¼Œå¹¶å¾—åˆ°å¯¹åº”çš„Documentï¼›</p>
</li>
<li>
<p>æ ¹æ®è¿”å›çš„Documentæ³¨å†ŒBeanä¿¡æ¯ã€‚</p>
</li>
</ul>
</li>
</ul>
<h5 id="è·å–xmlçš„éªŒè¯æ¨¡å¼">è·å–XMLçš„éªŒè¯æ¨¡å¼</h5>
<p>XMLæ–‡ä»¶çš„éªŒè¯æ¨¡å¼ä¿è¯äº†XMLæ–‡ä»¶çš„æ­£ç¡®æ€§ï¼Œå¸¸ç”¨çš„æœ‰DTDå’ŒXSDä¸¤ç§ã€‚</p>
<p>Springç”¨æ¥æ£€æµ‹éªŒè¯æ¨¡å¼çš„æ–¹æ³•å°±æ˜¯åˆ¤æ–­æ–‡æœ¬ä¸­æ˜¯å¦åŒ…å«DOCTYPEï¼Œå¦‚æœåŒ…å«å°±æ˜¯DTDï¼Œå¦åˆ™å°±æ˜¯XSDã€‚</p>
<h5 id="è·å–document">è·å–Document</h5>
<p>é€šè¿‡SAXè§£æXMLæ–‡æ¡£ï¼Œå¹¶ä¸”EntityResolverä½¿å¾—ç¨‹åºèƒ½å¤Ÿåœ¨é¡¹ç›®æœ¬èº«ä¸­å¯»æ‰¾DTDå£°æ˜ï¼Œé¿å…ç½‘ç»œä¸‹è½½çš„æ¼«é•¿æ—¶é—´æˆ–ç½‘ç»œä¸­æ–­é€ æˆçš„æŠ¥é”™ã€‚</p>
<h5 id="æ ¹æ®documentæ³¨å†Œbeanä¿¡æ¯">æ ¹æ®Documentæ³¨å†ŒBeanä¿¡æ¯</h5>

	

	

</article>





	<span class="different-posts">ğŸ“– <a href="/page/3">more posts</a> ğŸ“–</span>



	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<p>Hi there, <br />welcome to my Blog glad you found it. Have a look around, will you?</p>
</div>

	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2020 WeilunZhou | Powered by <a href="https://hexo.io/">Hexo</a> | Theme <a href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a></span>
		</div>

	</div>


</footer>



</body>

</html>
