{"title":"Systemd使用技巧","slug":"systemd","date":"2019-10-09T12:20:31.000Z","updated":"2020-02-16T06:31:34.539Z","comments":true,"path":"api/articles/systemd.json","photos":[],"link":"","excerpt":"","covers":null,"keywords":"","content":"<h1 id=\"systemd\">systemd</h1>\n<p>systemd的一些简单使用技巧</p>\n<h2 id=\"基本命令\">基本命令</h2>\n<p><code>systemctl</code> 命令:</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl status &lt;service_name&gt;         # 检查服务的状态</span><br><span class=\"line\">systemctl start &lt;service_name&gt;          # 启动服务</span><br><span class=\"line\">systemctl stop &lt;service_name&gt;           # 停止服务</span><br><span class=\"line\">systemctl enable &lt;service_name&gt;         # enable服务, 简单讲, 让服务开机就跑起来, 具体策略按服务的配置来.</span><br><span class=\"line\">systemctl disable &lt;service_name&gt;        # disable服务, 简单讲就是服务不再自动按照规定策略来跑了, 但不会停止现在已经跑起来的服务.</span><br><span class=\"line\">systemctl --daemon-reload               # 重新加载systemd的服务列表, 安装和修改`xxx.service`需要用</span><br></pre></td></tr></table></figure></div>\n<p><code>journalctl</code>命令: (#TODO)</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">journalctl                              #可以用来看日志 (TODO)</span><br></pre></td></tr></table></figure></div>\n<h2 id=\"service-template\">service template</h2>\n<p>下边是一个通过systemd来把一些linux下的long running的进程快速配置成服务变通的办法.</p>\n<ol>\n<li>先准备一个bash脚本, 用来long running的方式启动应用.</li>\n</ol>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># start.sh example.</span></span><br><span class=\"line\"><span class=\"comment\"># <span class=\"doctag\">NOTE:</span> use absolute path</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#!/usr/bin/sh</span></span><br><span class=\"line\">PROOT=<span class=\"string\">\"<span class=\"variable\">$( cd \"$(dirname \"$0\")</span>\"</span> ; <span class=\"built_in\">pwd</span> -P )<span class=\"string\">\"</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"variable\">$PROOT</span>/bin/prometheus \\</span></span><br><span class=\"line\"><span class=\"string\">        --storage.tsdb.path=\"</span>/var/data/prometheus/<span class=\"string\">\" \\</span></span><br><span class=\"line\"><span class=\"string\">        --config.file=\"</span><span class=\"variable\">$PROOT</span>/conf/prometheus.yml<span class=\"string\">\"</span></span><br></pre></td></tr></table></figure></div>\n<ol start=\"2\">\n<li>然后把下边的模板改改, 保存成 <code>xxxx.service</code> 放到 <code>/etc/systemd/system/</code> 下.  这个放的位置比较较粗糙.</li>\n</ol>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=prometheus</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">ExecStart=/bin/sh -c &apos;/home/oliveagle/app/prometheus/start.sh 2&gt;&amp;1&apos;</span><br><span class=\"line\">User=oliveagle</span><br><span class=\"line\">Group=oliveagle</span><br><span class=\"line\">Restart=always</span><br><span class=\"line\">RestartSec=10</span><br><span class=\"line\"># restart service every xxx seconds.</span><br><span class=\"line\"># RuntimeMaxSec=604800</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\"># NOTE: use default.target</span><br><span class=\"line\">WantedBy=default.target</span><br></pre></td></tr></table></figure></div>\n<ol start=\"3\">\n<li>通过<code>systemctl</code>命令加载, 安装, 启动</li>\n</ol>\n","categories":[],"tags":[{"name":"Linux","slug":"Linux","count":3,"path":"api/tags/Linux.json"}]}